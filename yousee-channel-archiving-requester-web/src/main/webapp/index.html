<!DOCTYPE html>
<html>
<head lang="en">
    <title>Statsbiblioteket's Radio/TV Channel Archive Request Interface</title>
    <link rel="stylesheet" type="text/css" media="all"
          href="style_all.css"/>
    <link rel="stylesheet" type="text/css" media="print"
          href="style_print.css"/>
    <link rel="stylesheet" type="text/css" media="screen"
          href="style_screen.css"/>
    <link href="bootstrap-3.2.0-dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css"
          href="http://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/css/jquery.dataTables.css">


</head>
<body>

<script charset="utf8" type="text/javascript" src="jquery-2.1.1.min.js"></script>
<script charset="utf8" src="jquery-ui-1.11.2/jquery-ui.js" type="text/javascript"></script>
<script charset="utf8" src="DataTables-1.9.0/media/js/jquery.dataTables.min.js" type="text/javascript"></script>
<script charset="utf8" src="jquery_jeditable/jquery.jeditable.js" type="text/javascript"></script>
<script charset="utf8" src="jquery-datatables-editable/media/js/jquery.dataTables.editable.js"
        type="text/javascript"></script>
<script charset="utf8" src="jquery-validation-1.13.1/dist/jquery.validate.js" type="text/javascript"></script>
<script charset="utf8" src="jquery-datatables-editable/media/js/jquery.jeditable.datepicker.js"
        type="text/javascript"></script>
<script charset="utf8" src="jquery-datatables-editable/media/js/jquery.jeditable.time.js"
        type="text/javascript"></script>

<script type="text/javascript" charset="utf8" src="bootstrap-3.2.0-dist/js/bootstrap.min.js"></script>
<script type="text/javascript" charset="utf8" src="datepicker/js/bootstrap-datepicker.js"></script>
<script type="text/javascript" src="jquery-timepicker/jquery.timepicker.js"></script>
<link rel="stylesheet" type="text/css" href="jquery-timepicker/jquery.timepicker.css"/>

<script type="text/javascript" src="jquery-timepicker/lib/bootstrap-datepicker.js"></script>
<link rel="stylesheet" type="text/css" href="jquery-timepicker/lib/bootstrap-datepicker.css"/>

<script type="text/javascript" src="jquery-timepicker/lib/site.js"></script>
<link rel="stylesheet" type="text/css" href="jquery-timepicker/lib/site.css"/>

<div class="span12 text-center">
    <h1>Statsbiblioteket's Radio/TV</h1>

    <h1>Channel Archive Request Interface</h1>
</div>
<div id="navigation">
    <form action="simple_dispatcher.jsp" name="nav_form" method="get">
        <a href="#" class="main_nav" onclick="gotopage('you_see_channel_mapping.jsp');">Channels</a>
        <a href="#" class="main_nav" onclick="gotopage('channel_archive_request.jsp');">Requests</a>
        <input id="page_name" type="hidden" name="page"/>
    </form>
</div>

<!-- Add the Channel Archive Request table -->
<table id="tableCAR">
    <thead>
    <tr>
        <th>Channel</th>
        <th>Start Time</th>
        <th>End Time</th>
        <th>From</th>
        <th>To</th>
        <th>Coverage</th>
    </tr>
    </thead>
    <tbody id="bodyCAR">
    </tbody>
</table>

<tr></tr>
<!-- Place holder where add and delete buttons will be generated -->
<div class="add_delete_toolbar"/>
<!-- Add buttons
<button id="btnDeleteRow">Delete</button>
<button id="btnAddNewRow">Add</button>-->
<br/>

<!-- Form that appears when add button is pressed-->
<div class="span12 text-center strong">
    <form id="formAddNewRow" action="#" title="ADD NEW REQUESTER">
        <label for="name">Channel</label><br/><input type="text" name="channel" id="channel" class="required" rel="0"/>
        <br/>

        <label for="name">From time</label><br/>
        <input type="text" name="fromTime" id="fromTime" class="required" rel="1"/>
        <br/>
        <label for="name">To time</label><br/>
        <input type="text" name="toTime" id="toTime" class="required" rel="2"/>
        <br/>
        <label for="name">Start day</label><br/>
        <input class="datepicker" data-date-format="yyyy-mm-dd" type="text" name="fromDate" id="fromDate"
               data-provider="datepicker" class="required" rel="3"/>
        <br/>
        <label for="name">End day</label><br/>
        <input class="datepicker" data-date-format="yyyy-mm-dd" type="text" name="toDate" id="toDate"
               data-provider="datepicker" class="required" rel="4"/>
        <br/>
        <label for="name">Coverage</label><br/>
        <select name="weekdayCoverage" id="weekdayCoverage" class="required" rel="5">
            <option value="1">DAILY</option>
            <option value="2">MONDAY</option>
            <option value="3">TUESDAY</option>
            <option value="4">WEDNESDAY</option>
            <option value="5">THURSDAY</option>
            <option value="6">FRIDAY</option>
            <option value="7">SATURDAY</option>
            <option value="8">SUNDAY</option>
            <option value="9">MONDAY-THURSDAY</option>
            <option value="10">MONDAY-FRIDAY</option>
            <option value="11">SATURDAY-SUNDAY</option>
        </select>
        <br/>
        <!-- Datepicker and timepicker code-->
        <script type="text/javascript" xml:space="preserve">
            $('.datepicker').datepicker({
                format: 'yyyy-mm-dd'
            })

            $(function () {
                $('#fromTime').timepicker({ 'timeFormat': 'H:i' });
            })
            $(function () {
                $('#toTime').timepicker({ 'timeFormat': 'H:i' });
            })


        </script>

    </form>
</div>


<script type="text/javascript" xml:space="preserve">
        function gotopage(page) {
            document.getElementById("page_name").setAttribute("value", page);
            document.nav_form.submit();
        }
        function addLoadEvent(func) {
            var oldonload = window.onload;
            if (typeof window.onload != 'function') {
                window.onload = func;
            } else {
                window.onload = function () {
                    oldonload();
                    func();
                }
            }
        }
    </script>
<script>

    <!--
    Convert
    the
    date
    to
    yyyy - mm - dd-->
    Date.prototype.toYYYYMMDDString = function () {
        return isNaN(this) ? 'NaN' : [
            this.getFullYear(),
                    this.getMonth() > 8 ? this.getMonth() + 1 : '0' + (this.getMonth() + 1),
                    this.getDate() > 9 ? this.getDate() : '0' + this.getDate()].join('-')
    }
    <!--Convert the time to hh:mm -->
    Date.prototype.toHHMMString = function () {
        return isNaN(this) ? 'NaN' : [
                    this.getHours() > 9 ? this.getHours() : '0' + this.getHours(),
                    this.getMinutes() > 9 ? this.getMinutes() : '0' + this.getMinutes()].join(':')
    }

    <!--Make a table line -->
    function makeCARRow(car) {
        var carRow = "car-" + car.id;
        var html = "<tr id='" + carRow + "'></tr>";
        $("#bodyCAR").append(html);
        $("#" + carRow).append("<td>" + car.sBChannelId + "</td>");
        $("#" + carRow).append("<td>" + new Date(parseInt(car.fromTime, 10)).toHHMMString() + "</td>");
        $("#" + carRow).append("<td>" + new Date(parseInt(car.toTime, 10)).toHHMMString() + "</td>");
        $("#" + carRow).append("<td>" + new Date(parseInt(car.fromDate, 10)).toYYYYMMDDString() + "</td>");
        $("#" + carRow).append("<td>" + new Date(parseInt(car.toDate, 10)).toYYYYMMDDString() + "</td>");
        $("#" + carRow).append("<td>" + car.weekdayCoverage + "</td>");
    }

    function loadCAR() {
        var url = "/youseechannelarchivingrequester/CAR/getCARList";
        $.getJSON(url, {}, function (carList) {
            //First put all lines in the table
            for (i in carList) {
                makeCARRow(carList[i]);
            }
            //then convert the table to a CRUD table, which also has some nice functionality like sorting
            $(".datetooltip").tooltip({placement: 'bottom'});
            var oTableCAR = $('#tableCAR').dataTable({
                "sPaginationType": "full_numbers"
            });
            $('#tableCAR').dataTable().makeEditable({
                sUpdateURL: "/youseechannelarchivingrequester/CAR/updateCAR",
                 aoColumns: [
                     {},
                     {
                         type: 'time',
                         submit: 'OK',
                         tooltip: "Click to edit...",
                         sSuccessResponse: "IGNORE"
                     },
                     {
                         type: 'time',
                         submit: 'OK',
                         tooltip: "Click to edit...",
                         sSuccessResponse: "IGNORE"
                     },
                     {
                         type: 'datepicker',
                         tooltip: "Click to edit...",
                         sSuccessResponse: "IGNORE",
                         datepicker: {
                             dateFormat: 'yyyy-mm-dd'
                         }
                     },
                     {
                         type: 'datepicker',
                         datepicker: {
                             dateFormat: 'yyyy-mm-dd'
                         },
                         tooltip: "Click to edit...",
                         sSuccessResponse: "IGNORE"
                     },
                     {
                         type: 'select',
                         onblur: 'cancel',
                         submit: 'Ok',
                         data: "{'DAILY':'DAILY','MONDAY':'MONDAY','TUESDAY':'TUESDAY','WEDNESDAY':'WEDNESDAY','THURSDAY':'THURSDAY'," +
                                 "'FRIDAY':'FRIDAY','SATURDAY':'SATURDAY','SUNDAY':'SUNDAY','MONDAY-THURSDAY':'MONDAY-THURSDAY'," +
                                 "'MONDAY-FRIDAY':'MONDAY-FRIDAY','SATURDAY-SUNDAY':'SATURDAY-SUNDAY'}"
                     }
                 ]
                 ,
                sDeleteURL: "/youseechannelarchivingrequester/CAR/deleteCAR",
                sAddURL: "/youseechannelarchivingrequester/CAR/addCAR",
                //The following functions are needed for refreshing the table after each function has been performed
                fnOnDeleted: function (status) {
                    oTableCAR.fnDraw(false);
                },
                fnOnAdded: function (status) {
                    oTableCAR.fnDraw(false);
                },
                fnOnEdited: function (status) {
                    oTableCAR.fnDraw(false);
                }
            });

        });
    }
    ;

    $(document).ready(function () {
        loadCAR();
    });

</script>

</body>
</html>
</body>